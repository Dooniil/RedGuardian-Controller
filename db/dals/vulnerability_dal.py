from sqlalchemy import select

from db.database import async_db_session
from db.models.vulnerability_models import Vulnerability, Family, Platform


class HostDAL:
    @staticmethod
    async def get_by_family(family_id: int):
        stmt = select(Platform).where(family_id=family_id)
        platforms = await async_db_session.execute(stmt).all()
        stmt = select(Vulnerability, Vulnerability.platform_id.in_((platform.id for platform in platforms)))
        vulnerabilities = await async_db_session.execute(stmt).all()
        return vulnerabilities
